<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BOT</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Automa√ß√£o monday</a>
        <img
          class="sm"
          src="Assets/logomonday.png"
          style="display: block; width: auto; height: 3rem"
          alt="logo-monday"
        />
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">In√≠cio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Sobre</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contato</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
 
    <!-- Conte√∫do Principal -->
 
    <div class="container mt-5">
      <h2>O que deseja Fazer?</h2>
    </div>
    <div class="container mt-5">
      <div class="row text-center">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Destribuir demandas</h5>
              <p class="card-text">Alocar novas demandas ao time</p>
              <button class="btn btn-primary" id="js-bot-autoQueue">Automatizar</button>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Criar Pasta</h5>
              <p class="card-text">ChatBot Moby/CRM</p>
              <button class="btn btn-primary" id="js-create-folder">Automatizar</button>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">Gerar Diag√≥stico</h5>
              <p class="card-text">Agilizar registro de diagnostico</p>
              <a href="diagnosticos.html" class="btn btn-primary" >Acessar</a>

            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Painel Admin Inteligente</h5>
              <p class="card-text">Painel unificado que testa automaticamente diferentes m√©todos de conex√£o e funciona em qualquer situa√ß√£o.</p>
              <a href="admin-panel-unified.html" target="_blank" class="btn btn-success"
                ><i class="fas fa-rocket"></i> Abrir Painel Unificado</a
              >
              <small class="text-muted d-block mt-2">
                <i class="fas fa-check-circle"></i> Conex√£o autom√°tica: Direto ‚Üí Proxy ‚Üí Offline
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- conte√∫do din√¢mico -->
    <div class="container mt-5"><h4>Conte√∫do alocado</h4></div>
    <hr>
      <table class="table table-bordered text-center" id="js-demandas-automaticas">
      <thead class="table-dark">
        <tr>
          <th>Cleinte</th>
          <th>Analista</th>
          <th>OBS</th>
        </tr>
      </thead>

      <!-- Se√ß√£o 1 - Azul -->
      <tbody class="table-primary" id="js-view-table">
        <!-- dados dinamicos -->
      </tbody>
    </footer>
   
    <script src="bot_functions/auto_queue.js"></script>
 
    <!-- Script para conectar com o servidor -->
    <script>
      // Fun√ß√£o para criar todas as pastas
      async function criarTodasPastas() {
        const botao = document.getElementById('js-create-all-folders');
        const textoOriginal = botao.innerHTML;
        
        try {
          // Desabilitar bot√£o e mostrar loading
          botao.disabled = true;
          botao.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Processando...';
          
          console.log('üîÑ Iniciando cria√ß√£o de pastas...');
          
          const response = await fetch('https://grifo-api.onrender.com/api/create-folder', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              folderPath: 'C:\\Users\\nasil01\\OneDrive - Fagron\\COM272 - FagronTech - Onboarding\\nova-pasta'
            })
          });
          
          const resultado = await response.json();
          
          if (resultado.success) {
            console.log('‚úÖ Pastas criadas com sucesso:', resultado);
            alert('‚úÖ Pastas criadas com sucesso via API externa!\n\n' + (resultado.message || 'Opera√ß√£o conclu√≠da'));
          } else {
            console.error('‚ùå Erro:', resultado.error);
            alert('‚ùå Erro ao criar pastas:\n\n' + resultado.error);
          }
          
        } catch (error) {
          console.error('‚ùå Erro de conex√£o:', error);
          alert('‚ùå Erro de conex√£o com API externa:\n\n' + error.message + '\n\nVerifique sua conex√£o com a internet.');
        } finally {
          // Reabilitar bot√£o
          botao.disabled = false;
          botao.innerHTML = textoOriginal;
        }
      }
      
      // Configura√ß√£o de APIs e proxies
      const API_ENDPOINTS = [
        'https://api-createfoder.onrender.com',
        'https://grifo-api.onrender.com'
      ];
      
      const CORS_PROXIES = [
        'https://cors-anywhere.herokuapp.com/',
        'https://api.allorigins.win/raw?url=',
        'https://corsproxy.io/?'
      ];
      
      // Sistema inteligente de conex√£o
      async function makeSmartApiRequest(endpoint, data) {
        // Tentar conex√£o direta com cada API
        for (const apiBase of API_ENDPOINTS) {
          try {
            console.log(`üîÑ Tentando conex√£o direta: ${apiBase}`);
            const response = await fetch(`${apiBase}${endpoint}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
            
            if (response.ok) {
              const result = await response.json();
              console.log(`‚úÖ Conex√£o direta funcionou: ${apiBase}`);
              return { success: true, data: result, method: `Direto: ${apiBase}` };
            }
          } catch (error) {
            console.log(`‚ö†Ô∏è Conex√£o direta falhou: ${apiBase} - ${error.message}`);
          }
        }
        
        // Tentar com proxies CORS
        for (let i = 0; i < CORS_PROXIES.length; i++) {
          const proxy = CORS_PROXIES[i];
          
          for (const apiBase of API_ENDPOINTS) {
            try {
              console.log(`üîÑ Tentando proxy ${i + 1}: ${proxy} + ${apiBase}`);
              const url = `${proxy}${encodeURIComponent(apiBase + endpoint)}`;
              
              const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              });
              
              if (response.ok) {
                const result = await response.json();
                console.log(`‚úÖ Proxy ${i + 1} funcionou: ${apiBase}`);
                return { success: true, data: result, method: `Proxy ${i + 1}: ${apiBase}` };
              }
            } catch (error) {
              console.log(`‚ö†Ô∏è Proxy ${i + 1} falhou: ${apiBase} - ${error.message}`);
            }
          }
        }
        
        return { success: false, error: 'Todas as conex√µes falharam', method: 'Nenhum' };
      }
      
      // Fun√ß√£o para criar pastas via API inteligente
      async function criarPastas() {
        const botao = document.getElementById('js-create-folder');
        const textoOriginal = botao.innerHTML;
        
        try {
          // Desabilitar bot√£o durante processamento
          botao.disabled = true;
          botao.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Conectando...';
          
          console.log('üöÄ Iniciando sistema inteligente de cria√ß√£o de pastas...');
          
          const folderData = {
             folderPath: `C:\\Users\\nasil01\\OneDrive - Fagron\\COM272 - FagronTech - Onboarding\\nova-pasta-${Date.now()}`
           };
           
           console.log('üìÅ Dados da pasta:', folderData);
          
          botao.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Testando conex√µes...';
          
          const resultado = await makeSmartApiRequest('/api/create-folder', folderData);
           
           if (resultado.success) {
             // Verificar se a API retornou sucesso
             if (resultado.data && resultado.data.success) {
               console.log('‚úÖ Pasta criada com sucesso:', resultado.data);
               alert(`‚úÖ Pasta criada com sucesso!\n\n` +
                     `M√©todo: ${resultado.method}\n` +
                     `Pasta: ${folderData.folderPath}\n\n` +
                     `${resultado.data.message || 'Opera√ß√£o conclu√≠da'}`);
             } else {
               // Conex√£o funcionou mas API retornou erro
               console.error('‚ùå Erro da API:', resultado.data);
               alert(`‚ùå Erro da API (conex√£o OK)\n\n` +
                     `M√©todo: ${resultado.method}\n` +
                     `Erro: ${resultado.data.error || 'Erro desconhecido'}\n\n` +
                     `A conex√£o funcionou mas a API rejeitou a requisi√ß√£o.`);
             }
           } else {
             console.error('‚ùå Todas as conex√µes falharam:', resultado.error);
             alert(`‚ùå Erro: N√£o foi poss√≠vel conectar com nenhuma API\n\n` +
                   `Detalhes: ${resultado.error}\n\n` +
                   `Poss√≠veis causas:\n` +
                   `‚Ä¢ APIs offline\n` +
                   `‚Ä¢ Problemas de CORS\n` +
                   `‚Ä¢ Proxies bloqueados\n\n` +
                   `Tente novamente em alguns minutos.`);
           }
          
        } catch (error) {
          console.error('‚ùå Erro inesperado:', error);
          alert(`‚ùå Erro inesperado no sistema:\n\n${error.message}`);
        } finally {
          // Reabilitar bot√£o
          botao.disabled = false;
          botao.innerHTML = textoOriginal;
        }
      }
      
      // Conectar eventos aos bot√µes quando a p√°gina carregar
      document.addEventListener('DOMContentLoaded', function() {
        // Bot√£o criar pastas
        const botaoCreateFolder = document.getElementById('js-create-folder');
        if (botaoCreateFolder) {
          botaoCreateFolder.addEventListener('click', function(e) {
            e.preventDefault();
            criarPastas();
          });
        }
        
        // Bot√£o criar todas as pastas (se existir)
        const botao = document.getElementById('js-create-all-folders');
        if (botao) {
          botao.addEventListener('click', function(e) {
            e.preventDefault();
            criarTodasPastas();
          });
        }
      });
    </script>

    </footer>
    
    <script src="bot_functions/auto_queue.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>